import{a as x}from"./chunk-TYVXPFJG.js";import{a as E}from"./chunk-TEHB7NO6.js";import{a as F,d as P}from"./chunk-GYU5LNTV.js";import{a as C}from"./chunk-7DV4EETS.js";import{c as k}from"./chunk-Q6J33HRF.js";import{o as w}from"./chunk-OEVEVLY2.js";import{Fb as M,Ka as l,Va as v,Xb as h,Y as u,e as y,pb as g,ra as f,xb as b,yb as L,zb as S}from"./chunk-XLW5XAEJ.js";var c=y(F());var I=["map"],U=(()=>{let o=class o{constructor(s,i,t){this.publicPropertyService=s,this.placesService=i,this.queryService=t,this.http=f(k),this.baseUrl=C.baseUrl,this.markers=[],this.lngLat=[2.187975058256683,41.392281189125214],this.stateSignal=v({loading:!0,properties:[]}),this.properties=h(()=>this.stateSignal().properties),this.loading=h(()=>this.stateSignal().loading)}ngOnInit(){this.queryService.query$.subscribe(s=>{this.filterProperties(s)})}ngAfterViewInit(){if(!this.divMap)throw"El elemento HTML no fue encontrado";this.map=new c.Map({container:this.divMap?.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:this.lngLat,zoom:13})}filterProperties(s=""){this.publicPropertyService.getPublicProperties().subscribe(i=>{let t=[];if(i.forEach(e=>{let r=0,a=0;this.placesService.useLocation&&([r,a]=this.placesService.useLocation),r!==0&&a!==0&&!s&&this.placesService.calculateDistance(r,a,Number(e.longitude),Number(e.latitude))&&t.push(e),s&&(e.city.toLowerCase().includes(s.toLowerCase())&&t.push(e),e.postalCode.includes(s)&&t.push(e)),!this.placesService.useLocation&&!s&&t.push(e)}),this.stateSignal.set({loading:!1,properties:t}),this.map&&(this.markers.forEach(e=>e.remove()),this.markers=[],this.addMarkers(t),t.length>0)){let e=t.map(n=>parseFloat(n.longitude)),r=t.map(n=>parseFloat(n.latitude)),a=e.reduce((n,p)=>n+p)/e.length,m=r.reduce((n,p)=>n+p)/r.length;this.map.setCenter([a,m])}})}addMarkers(s){s.forEach(i=>{let t=document.createElement("div");t.className="custom-marker";let e=document.createElement("div");e.innerHTML=`
      <div>
        <strong><a href="/property-details/${i.id}">${i.name}</a></strong><br>
        Habitaciones disponibles: ${i.rooms.filter(m=>m.is_available).length}
      </div>
    `,t.appendChild(e);let r=new c.LngLat(parseFloat(i.longitude),parseFloat(i.latitude)),a=new c.Marker({color:"#30daa6"}).setLngLat(r).addTo(this.map);this.markers.push(a)})}};o.\u0275fac=function(i){return new(i||o)(l(E),l(P),l(x))},o.\u0275cmp=u({type:o,selectors:[["map-with-marker"]],viewQuery:function(i,t){if(i&1&&b(I,5),i&2){let e;L(e=S())&&(t.divMap=e.first)}},standalone:!0,features:[M],decls:2,vars:0,consts:[["id","map",1,"w-full","h-[60vh]"],["map",""]],template:function(i,t){i&1&&g(0,"div",0,1)},dependencies:[w],styles:[".marker[_ngcontent-%COMP%]{color:#fff;padding:10px;border-radius:5px;font-size:14px;font-weight:700}"]});let d=o;return d})();export{U as default};
