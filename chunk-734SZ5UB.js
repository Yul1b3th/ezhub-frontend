import{a as A}from"./chunk-7DV4EETS.js";import{b as f,c as S}from"./chunk-Q6J33HRF.js";import{E as c,Va as l,Xb as m,ga as d,ra as g,s as u,t as p,w as h}from"./chunk-XLW5XAEJ.js";var a=function(r){return r.checking="checking",r.authenticated="authenticated",r.notAuthenticated="notAuthenticated",r}(a||{});var w=(()=>{let o=class o{constructor(){this.baseUrl=A.baseUrl,this.http=g(S),this._currentUser=l(null),this._authStatus=l(null),this.currentUser=m(()=>this._currentUser()),this.authStatus=m(()=>this._authStatus()),this.checkAuthStatus().subscribe();let t=localStorage.getItem("isAuthenticated")==="true";this._authStatus.set(t?a.authenticated:a.notAuthenticated)}setAuthentication(t,e){return this._currentUser.set(t),this._authStatus.set(a.authenticated),localStorage.setItem("token",e),localStorage.setItem("isAuthenticated","true"),!0}login(t,e){let i=`${this.baseUrl}/auth/login`,n={usernameOrEmail:t,password:e};return this.http.post(i,n).pipe(h(({user:s,token:b})=>this.setAuthentication(s,b)),c(s=>p(()=>s.error.message)))}checkAuthStatus(){let t=`${this.baseUrl}/auth/check-token`,e=localStorage.getItem("token");if(!e)return this.logout(),u(!1);let i=new f().set("Authorization",`Bearer ${e}`);return this.http.get(t,{headers:i}).pipe(h(({user:n,token:s})=>(localStorage.setItem("token",s),this.setAuthentication(n,s))),c(()=>(this._authStatus.set(a.notAuthenticated),u(!1))))}register(t,e,i){let n=`${this.baseUrl}/auth/register`,s={username:t,email:e,password:i};return this.http.post(n,s)}logout(){localStorage.removeItem("token"),this._currentUser.set(null),this._authStatus.set(a.notAuthenticated),localStorage.removeItem("isAuthenticated")}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"});let r=o;return r})();export{a,w as b};
