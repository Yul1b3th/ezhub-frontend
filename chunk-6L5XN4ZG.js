import{a as A}from"./chunk-TEHB7NO6.js";import{d as L}from"./chunk-GYU5LNTV.js";import{a as S}from"./chunk-7DV4EETS.js";import{c as P}from"./chunk-Q6J33HRF.js";import{Va as R,Xb as d,f as n,g as f,ga as v,h as b,qa as g,ra as h,w as p}from"./chunk-XLW5XAEJ.js";var k=(()=>{var l;let a=class a{constructor(t){f(this,l,void 0);this.placesService=t,this.http=h(P),this.publicPropertyService=h(A),this.baseUrl=S.baseUrl,b(this,l,R({loading:!0,rooms:[]})),this.rooms=d(()=>n(this,l).call(this).rooms),this.loading=d(()=>n(this,l).call(this).loading),this.getPublicRooms(),this.filterRooms()}getPublicRooms(){this.publicPropertyService.getPublicProperties().subscribe(t=>{let e=[];t.forEach(i=>{let o=i.rooms.filter(c=>c.deletedAt===null&&c.is_available);e=e.concat(o)}),n(this,l).set({loading:!1,rooms:e})})}getRoomById(t){return this.http.get(`${this.baseUrl}/public-rooms/${t}`).pipe(p(e=>e))}getRoomAmenities(t){return this.http.get(`${this.baseUrl}/public-rooms/${t}/amenities`)}searchRooms(t){this.http.get(`${this.baseUrl}/public-rooms`,{params:{query:t}}).subscribe(e=>{n(this,l).set({loading:!1,rooms:e})})}filterRooms(t=""){this.publicPropertyService.getPublicProperties().subscribe(e=>{let i=[];e.forEach(o=>{let c=0,u=0;if(this.placesService.useLocation&&([c,u]=this.placesService.useLocation),c!==0&&u!==0&&!t&&this.placesService.calculateDistance(c,u,Number(o.longitude),Number(o.latitude))){let r=o.rooms.filter(s=>s.deletedAt===null&&s.is_available);i=i.concat(r)}if(t){if(o.city.toLowerCase().includes(t.toLowerCase())){let r=o.rooms.filter(s=>s.deletedAt===null&&s.is_available);i=i.concat(r)}if(o.postalCode.includes(t)){let r=o.rooms.filter(s=>s.deletedAt===null&&s.is_available);i=i.concat(r)}}if(!this.placesService.useLocation&&!t){let r=o.rooms.filter(s=>s.deletedAt===null&&s.is_available);i=i.concat(r)}}),n(this,l).set({loading:!1,rooms:i})})}};l=new WeakMap,a.\u0275fac=function(e){return new(e||a)(g(L))},a.\u0275prov=v({token:a,factory:a.\u0275fac,providedIn:"root"});let m=a;return m})();export{k as a};
